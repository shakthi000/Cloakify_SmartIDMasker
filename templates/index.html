<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Smart ID Masker</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
:root {
  --bg1:#0f172a; --bg2:#1e293b; --brand:#7c3aed; --brand-2:#22d3ee;
}
body {
  min-height:100vh;
  background:
    radial-gradient(60rem 60rem at 120% -10%, rgba(124,58,237,.25), transparent 60%),
    radial-gradient(50rem 50rem at -10% 110%, rgba(34,211,238,.2), transparent 60%),
    linear-gradient(135deg, var(--bg1), var(--bg2));
  color:#e5e7eb; font-family:sans-serif;
}

.glass { background:rgba(255,255,255,0.08); backdrop-filter:blur(12px); border:1px solid rgba(255,255,255,0.12); border-radius:1rem; }
.fade-in { animation:fadeIn .8s ease forwards; opacity:0; transform:translateY(8px); }
@keyframes fadeIn { to{ opacity:1; transform:translateY(0); } }

.reveal { position:relative; overflow:hidden; transform:translateZ(0); margin-top:1rem; }
.reveal img { opacity:0; transform:scale(1.02); }
.reveal.ready img { animation:imgIn .9s ease forwards; }
.reveal::before {
  content:""; position:absolute; inset:0;
  background:linear-gradient(90deg, rgba(124,58,237,.35), rgba(34,211,238,.35));
  transform:translateX(-110%);
}
.reveal.ready::before { animation:wipe .9s ease forwards; }
@keyframes wipe { to{ transform:translateX(110%); } }
@keyframes imgIn { to{ opacity:1; transform:scale(1); } }

.dropzone { border:2px dashed rgba(255,255,255,0.25); transition:border-color .25s ease, background-color .25s ease; cursor:pointer; padding:2rem; text-align:center; }
.dropzone.dragover { border-color:var(--brand-2); background:rgba(34,211,238,.08); }

.overlay { display:none; position:fixed; inset:0; background:rgba(10,10,20,.75); z-index:50; place-items:center; }
.spinner { width:64px; height:64px; border-radius:9999px; border:6px solid rgba(255,255,255,.2); border-top-color:var(--brand); animation:spin 1s linear infinite; }
@keyframes spin { to { transform:rotate(360deg); } }

</style>
</head>
<body class="pb-20 flex flex-col items-center">

<!-- Overlay Spinner -->
<div id="overlay" class="overlay grid">
  <div class="flex flex-col items-center gap-4">
    <div class="spinner"></div>
    <p class="text-lg tracking-wide">Masking in progressâ€¦</p>
  </div>
</div>

<header class="max-w-3xl mx-auto px-4 pt-10 pb-6 fade-in text-center">
  <h1 class="text-4xl font-black tracking-tight">Cloakify: <span class="text-transparent bg-clip-text bg-gradient-to-r from-violet-400 to-cyan-300">Smart ID Masker</span></h1>
  <p class="text-slate-300 mt-3">Instantly redact sensitive info from invoices & docs. Upload and see masked preview!</p>
</header>

<main class="max-w-3xl mx-auto px-4 grid gap-8 items-start">

  <!-- Upload Form -->
  <form method="post" enctype="multipart/form-data" class="glass p-6 fade-in" id="uploadForm">
    <label id="dropzone" class="dropzone rounded-xl flex flex-col items-center justify-center">
      <div class="text-slate-200"><strong>Click to choose</strong> or drag & drop</div>
      <div id="fileName" class="text-xs text-slate-400 mt-1">No file selected</div>
      <input id="fileInput" class="hidden" type="file" name="file" accept=".jpg,.jpeg,.png"/>
    </label>

    <div id="errorMsg" class="text-red-400 text-xs mt-2 hidden"></div>

    <div class="mt-6">
      <label class="block text-sm mb-2">Mask Style</label>
      <select name="mask_type" class="w-full rounded-lg bg-slate-900/40 border border-white/10 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-cyan-400">
        <option value="blur">Blur (Natural)</option>
        <option value="black">Blackout (Solid)</option>
      </select>
    </div>

    <button type="submit" class="mt-6 w-full rounded-xl bg-gradient-to-r from-violet-600 to-cyan-400 text-slate-900 font-bold py-3 shadow-lg hover:opacity-95 transition">Upload & Mask</button>
    <p class="text-xs text-slate-400 mt-3">OCR runs locally on the server. No data stored beyond session.</p>
  </form>

  <!-- Preview Section -->
  {% if preview_img %}
    <div class="glass p-5 fade-in">
      <div class="flex items-center justify-between mb-3">
        <h2 class="text-xl font-bold">Preview</h2>
        <a href="{{ download_url }}" download class="rounded-lg bg-emerald-500/90 hover:bg-emerald-500 px-4 py-2 text-sm font-semibold text-white shadow">ðŸ“¥ Download</a>
      </div>
      <div class="reveal rounded-lg overflow-hidden border border-white/10 bg-black/20">
        <img src="{{ preview_img }}" alt="Masked Preview" class="block w-full h-auto" onload="readyReveal(this)">
      </div>
    </div>
  {% else %}
    <div class="glass p-6 fade-in text-slate-300">
      <h3 class="text-lg font-semibold mb-2">How it works</h3>
      <ol class="list-decimal ml-5 space-y-1 text-sm">
        <li>Choose an image file.</li>
        <li>Select blur or blackout.</li>
        <li>Hit <em>Upload & Mask</em> and watch the reveal!</li>
      </ol>
    </div>
  {% endif %}

</main>

<footer class="max-w-3xl mx-auto px-4 mt-10 text-xs text-slate-400 text-center">
  Built with ðŸ’œ by The Conquerors â€¢ OCR + Regex + NER
</footer>

<script>
const drop = document.getElementById('dropzone');
const fileInput = document.getElementById('fileInput');
const fileName = document.getElementById('fileName');
const form = document.getElementById('uploadForm');
const overlay = document.getElementById('overlay');
const errorMsg = document.getElementById('errorMsg');

const validTypes = ['image/png','image/jpeg'];
const maxSize = 5*1024*1024; // 5MB

function validateFile(file){
  if(!file){ showError("âš ï¸ Please select a file."); return false; }
  if(!validTypes.includes(file.type)){ showError("âŒ Invalid file type."); return false; }
  if(file.size>maxSize){ showError("ðŸ“¦ File is too large."); return false; }
  clearError(); return true;
}
function showError(msg){ errorMsg.textContent=msg; errorMsg.classList.remove("hidden"); }
function clearError(){ errorMsg.textContent=""; errorMsg.classList.add("hidden"); }

drop.addEventListener('click', ()=>fileInput.click());
drop.addEventListener('dragover', e=>{ e.preventDefault(); drop.classList.add('dragover'); });
drop.addEventListener('dragleave', ()=>drop.classList.remove('dragover'));
drop.addEventListener('drop', e=>{
  e.preventDefault(); drop.classList.remove('dragover');
  const file = e.dataTransfer.files[0];
  if(validateFile(file)){ fileInput.files=e.dataTransfer.files; fileName.textContent=file.name; }
  else{ fileInput.value=""; fileName.textContent="No file selected"; }
});

fileInput.addEventListener('change', ()=>{
  const file = fileInput.files[0];
  if(validateFile(file)){ fileName.textContent=file.name; }
  else{ fileInput.value=""; fileName.textContent="No file selected"; }
});

form.addEventListener('submit', e=>{
  const file = fileInput.files[0];
  if(!file || !validateFile(file)){ e.preventDefault(); return false; }
  overlay.style.display='grid';
});

function readyReveal(imgEl){
  const wrap = imgEl.closest('.reveal'); if(wrap) wrap.classList.add('ready');
}
</script>
</body>
</html>
